<!DOCTYPE html> 
<html> 
<!-- The following code has been developed by students and/or researchers of the Freshman Research Initiative DIY Diagnostics Stream at The University of Texas at Austin.  This code is shared for demonstration purposes and should not be considered a product -- it is for entertainment purposes only.  Any user of this code does so at their own risk. Members of the DIY Stream, FRI, and The University of Texas system are not liable for anything related to this code.
  
 
Authors in chronological order of contribution:
Alijah James
Emma Aldred
Tim Riedel
 
Further Information:
http://cns.utexas.edu/fri
 
Research Educator:
Timothy Riedel
triedel@utexas.edu
 
Brief Description of Goal of Code:
The goal is to create a web-based app that helps users who are likely to be college students determine if they are sleep deprived.
 
Known Issues:
ADD
https://www.w3schools.com/w3css/default.asp
https://stackoverflow.com/questions/8211128/multiple-distinct-pages-in-one-html-file
-->
	<head> 
		<title>Sleep Deprivation</title>
		<meta charset = "UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<link rel="stylesheet" href="w3.css">
		<link rel="stylesheet" href="w3-colors-flat.css">
		<!--<script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
		<script src="https://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>-->
	</head>
		
	<script>
		var docMod = document.lastModified; // loads last modified time stamp into docMod variable
			alert("This file last modified " + docMod); // generates alert box with time stamp. If annoying, comment out this entire line.
			console.log("This file last modified " + docMod); // generates message in javaScript console (found in developers tools) with time stamp.
		
		var startTime, endTime; 
		var user_saccade=[];
		
		function start() {
			//alert("Start function is being called");
			startTime = new Date();
		}
		
		function draw(){
			var mycanvas;
			var mycontext;
			mycanvas = document.getElementById("canvas"); //finds the canvas with the Id 'canvas'
			mycontext = mycanvas.getContext("2d"); //sets up the context of the function with 2d
			mycontext.beginPath();
			mycontext.arc(325, 175, 10, 0, 2 * Math.PI);
			mycontext.stroke();
			mycontext.fillStyle = "red";
			mycontext.fill();
		}
		
		var i = 0;
		var width = 0;
		
		function letter(){
			var randomletter = Math.random().toString(36).replace(/[^a-z]+/g, '').substr(0,1).split('').map(c => Math.random() < 0.5 ? c.toUpperCase() : c).join('');
			var mycanvas = document.getElementById("canvas"); //finds the canvas with the Id 'a'
			var mycontext = mycanvas.getContext("2d"); //sets up the context of the function with 2dv
			if (i % 2 == 0){
			//	mycontext.clear(0, 150, 50, 50);
				width = 1;
			}
			else{
			//	mycontext.clear(600, 150, 50, 50);
				width = 628;
			}
			mycontext.font = "bold 24px sans-serif"; //determines the font of the text
			mycontext.fillStyle = "black";
			mycontext.fillText(randomletter,width,175); //declares and prints the text and gives placement
			i++;
		}
		
		var timeDiff;
		
		function stop() {
			//alert("stop function is being called");
			var g = 1000; //delay time in ms for letter
			endTime = new Date();
			timeDiff = endTime - startTime - g; //in ms
				// strip the ms
			timeDiff /= 1000;
				// get seconds 
			document.getElementById("time_list").innerHTML = timeDiff;
			user_saccade.push(timeDiff);
			document.getElementById("results").innerHTML = user_saccade;
			
		}
		
		function reset(){
			//alert("reset function is being called");
			var mycanvas = document.getElementById("canvas"); //finds the canvas with the Id 'a'
			var mycontext = mycanvas.getContext("2d"); //sets up the context of the function with 2d
			mycanvas.width=650;
			mycanvas.height=350;
		}
		
		function average(){
			var sum = user_saccade.reduce((previous, current) => current += previous);
			var avg = sum/user_saccade.length;
			document.getElementById("avg").innerHTML = avg;
		}
			
	</script>
	
	<style>
		.body {
			margin: 0em;
		}
		.page {
			width: 100vw;
			height: 100vh;
			position: fixed;
			top: 0;
			left: -100vw;
			overflow-y: auto;
			z-index: 0;
			background-color: hsl(0,0%,100%);
		}
		.page:target {
			left: 0vw;
			z-index: 1;
		}
	</style>
	<!-- above sets the web-page's dimensions and look-->	
	
	<body>
		<div id="header" class="w3-container w3-light-blue">
			<h1>Sleep Deprivation Diagnostic</h1><!-- /header -->
		</div> <!-- /content -->
			
		<div id="content" class= "w3-container"> <!--first page of app-->
			<h2>Instructions: </h2><!--need to update instructions-->
			<p>Hold your phone sideways at an arms length distance from your face. When ready, press start and stare at the red dot. A black letter will flash on either side of the dot. 
				When you see this letter, press the stop button. This will record an individual saccade. Press reset to start again. Repeat this at least 20 times 
				before going to view your results for the most accurate diagnosis.</p>
			<p>Click here to go to the test</p>
			<a href="#one" class="w3-btn w3-light-blue w3-round"> Get Started </a>
			
			<div class = "page" id= "one">
				<div id="header" class="w3-container w3-light-blue">
					<h1>Sleep Deprivation Diagnostic</h1>
				</div>
				<div id="content" class="w3-container">
				
					<button onclick="start();draw();setTimeout(letter, 1000);">Start</button>
					<button onclick="stop();">Stop</button>
					<button onclick="reset();">Reset</button>
				
					<canvas id= "canvas" width="650" height="350" style= "border:1px solid #000000;"></canvas>
					<p id="time_list"></p>
					<p id="check"></p>

					<a href="#two" class="w3-btn w3-light-blue w3-round"> Go see results </a>
				</div>
			</div>
			
			<div class = "page" id= "two">
				<div id="header" class="w3-container w3-light-blue">
					<h1>Sleep Deprivation Diagnostic</h1>
				</div>
				<div id="content" class="w3-container">
					<p>Here is a list of all your individual saccade times</p>
					<p id="results"></p>
					<button onclick="average();">Get Average</button>
					<p id="avg"></p>
				</div>
			</div>
		
		</div>
		
		<div id = "footer" class="w3-bottom w3-panel w3-flat-alizarin" data-position= "fixed">
			<h5>DIY Diagnostics</h5>
		</div>
		<!--footer not displaying in the right spot-->
   </body>
</html>
